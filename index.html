<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sphere Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Reset e layout geral */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }
    /* Container do mapa */
    #map {
      width: 100%;
      height: 100vh;
    }
    /* Estilo dos tooltips dos marcadores */
    .castle-label {
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      color: white;
      text-shadow: 1px 1px 2px black;
      white-space: nowrap;
      background: none;
      border: none;
      padding: 2px;
    }
    /* Painel de controle */
    #control-panel {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 350px;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 15px;
      border-radius: 8px;
      z-index: 1000;
    }
    #control-panel h1 {
      margin: 0 0 10px;
      font-size: 20px;
      text-align: center;
    }
    /* Container das bandeiras de idioma */
    #lang-switch {
      text-align: center;
      margin-bottom: 10px;
    }
    #lang-switch img {
      width: 25px;
      height: 25px;
      cursor: pointer;
      margin: 0 5px;
    }
    /* Botões "Mostrar tudo" e "Esconder tudo" */
    .button-group {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .button-group button {
      flex: 1;
      margin: 0 5px;
      padding: 8px;
      background: #444;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .button-group button:hover {
      background: #666;
    }
    /* Caixa de pesquisa com auto-complete */
    .search-container {
      display: flex;
      margin-bottom: 10px;
      position: relative;
    }
    .search-container input[type="text"] {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 4px 0 0 4px;
      font-size: 14px;
      color: #555;
    }
    .search-container input[type="text"]::placeholder {
      color: #777;
    }
    .search-container button {
      padding: 8px 12px;
      border: none;
      background: #444;
      color: white;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
    .search-container button:hover {
      background: #666;
    }
    /* Sugestões de pesquisa */
    #searchSuggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ccc;
      z-index: 1100;
      display: none;
      max-height: 150px;
      overflow-y: auto;
    }
    #searchSuggestions div {
      padding: 8px;
      cursor: pointer;
      color: #333;
    }
    #searchSuggestions div:hover {
      background: #f0f0f0;
    }
    /* Área para exibir coordenadas do clique no mapa */
    #coords {
      margin-top: 10px;
      font-size: 14px;
      text-align: center;
      padding: 5px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
    }
    /* Dropdowns: os conteúdos se expandem no fluxo */
    .dropdown {
      margin-bottom: 10px;
    }
    /* Cabeçalho dos dropdowns com checkbox para categoria */
    .dropdown > .dropdown-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }
    .dropdown > .dropdown-header label {
      margin: 0;
      font-size: 16px;
      cursor: pointer;
    }
    .dropdown > .dropdown-header button {
      background: #444;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px;
      cursor: pointer;
    }
    .dropdown > .dropdown-header button:hover {
      background: #666;
    }
    .dropdown-content {
      display: none;
      margin-top: 5px;
      background: #555;
      padding: 10px;
      border-radius: 4px;
    }
    .dropdown-content label {
      display: block;
      margin-bottom: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    /* Sub-dropdowns para Comerciantes */
    .dropdown .dropdown {
      margin-bottom: 0;
    }
    .dropdown .dropdown > button {
      background: #666;
      font-size: 13px;
    }
    .dropdown .dropdown-content {
      background: #777;
      padding: 5px;
    }
    .dropdown .dropdown-content label {
      font-size: 13px;
    }
  </style>
</head>
<body>
  <!-- Painel de controle -->
  <div id="control-panel">
    <!-- Bandeiras de idioma -->
    <div id="lang-switch">
      <img src="Ico/Brasil.png" id="lang-pt" alt="Português">
      <img src="Ico/Ingles.png" id="lang-en" alt="English">
    </div>
    <h1 id="title">Mapa Sphere</h1>
    <div class="button-group">
      <button id="btn-showAll">Mostrar tudo</button>
      <button id="btn-hideAll">Esconder tudo</button>
    </div>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Pesquisar..." />
      <button id="searchButton">Pesquisar</button>
      <div id="searchSuggestions"></div>
    </div>
    <div id="coords">Clique no mapa para ver as coordenadas</div>
    
    <!-- Dropdown Castelos -->
    <div class="dropdown">
      <div class="dropdown-header">
        <label>
          <input type="checkbox" id="toggle-castelos" checked> 
          <img src="Ico/Castelo.png" style="width:20px;height:20px;margin-right:5px;">
          <span id="label-castelos">Castelos</span>
        </label>
        <button id="dropdown-castelos">&#9662;</button>
      </div>
      <div class="dropdown-content" id="dropdown-content-castelos">
        <label><input type="checkbox" id="castle15" checked> <span id="label-castelos15">Castelos 15</span></label>
        <label><input type="checkbox" id="castle30" checked> <span id="label-castelos30">Castelos 30</span></label>
        <label><input type="checkbox" id="castle45" checked> <span id="label-castelos45">Castelos 45</span></label>
      </div>
    </div>
    
    <!-- Dropdown Teleporte de Runas -->
    <div class="dropdown">
      <div class="dropdown-header">
        <label>
          <input type="checkbox" id="toggle-teleporte" checked> 
          <img src="Ico/Teleporte.png" style="width:20px;height:20px;margin-right:5px;">
          <span id="label-teleporte">Teleporte de Runas</span>
        </label>
        <button id="dropdown-teleporte">&#9662;</button>
      </div>
      <div class="dropdown-content" id="dropdown-content-teleporte">
        <label><input type="checkbox" id="teleporte1" checked> Northern Road of Hyperion</label>
        <label><input type="checkbox" id="teleporte2" checked> North-western end of Hyperion</label>
        <label><input type="checkbox" id="teleporte3" checked> Sheepston-Sunpool Road</label>
        <label><input type="checkbox" id="teleporte4" checked> Field by the Sheepstone-Sunpool Road</label>
        <label><input type="checkbox" id="teleporte5" checked> North-east of Hyperion</label>
        <label><input type="checkbox" id="teleporte6" checked> Umrad Forest</label>
        <label><input type="checkbox" id="teleporte7" checked> Silver Forest</label>
        <label><input type="checkbox" id="teleporte8" checked> Sheepston-Torweal Road</label>
        <label><input type="checkbox" id="teleporte9" checked> Mountains between Sheepstone and Bangville</label>
        <label><input type="checkbox" id="teleporte10" checked> Lake Temer</label>
        <label><input type="checkbox" id="teleporte11" checked> Sheepston-Sunpool Road near Lake Vortex</label>
        <label><input type="checkbox" id="teleporte12" checked> Sunpool-Bangville Road near Lake Vortex</label>
        <label><input type="checkbox" id="teleporte13" checked> Heber Island (Lake Temer)</label>
        <label><input type="checkbox" id="teleporte14" checked> Foros Island (Lake Vortex)</label>
        <label><input type="checkbox" id="teleporte15" checked> Mounth of the Nerey</label>
        <label><input type="checkbox" id="teleporte16" checked> Deyros Island (Lake Vortex)</label>
        <label><input type="checkbox" id="teleporte17" checked> Eastern Forest</label>
        <label><input type="checkbox" id="teleporte18" checked> Mounth of Dioma</label>
        <label><input type="checkbox" id="teleporte19" checked> Horton Forest</label>
        <label><input type="checkbox" id="teleporte20" checked> Mountains near the Sunpool-Torweal Road</label>
        <label><input type="checkbox" id="teleporte21" checked> Island Patros (Lake Satin)</label>
        <label><input type="checkbox" id="teleporte22" checked> South-Eastern mountains pocket</label>
        <label><input type="checkbox" id="teleporte23" checked> North of Coyton Forest</label>
        <label><input type="checkbox" id="teleporte24" checked> South-western end of Hyperion</label>
        <label><input type="checkbox" id="teleporte25" checked> Tantal Bridge</label>
        <label><input type="checkbox" id="teleporte26" checked> Obol</label>
      </div>
    </div>
    
    <!-- Dropdown Profissões -->
    <div class="dropdown">
      <div class="dropdown-header">
        <label>
          <input type="checkbox" id="toggle-profissoes" checked> 
          <img src="Ico/Profissao.png" style="width:20px;height:20px;margin-right:5px;">
          <span id="label-profissoes">Profissões</span>
        </label>
        <button id="dropdown-profissoes">&#9662;</button>
      </div>
      <div class="dropdown-content" id="dropdown-content-profissoes">
        <label>
          <input type="checkbox" id="prof-arquimago" checked> 
          <img src="Ico/Arquimago.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-arquimago">Arquimago</span>
        </label>
        <label>
          <input type="checkbox" id="prof-armeiro" checked> 
          <img src="Ico/Armeiro.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-armeiro">Armeiro</span>
        </label>
        <label>
          <input type="checkbox" id="prof-assassino" checked> 
          <img src="Ico/Assassino.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-assassino">Assassino</span>
        </label>
        <label>
          <input type="checkbox" id="prof-barbaro" checked> 
          <img src="Ico/Barbaro.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-barbaro">Bárbaro</span>
        </label>
        <label>
          <input type="checkbox" id="prof-bandoleiro" checked> 
          <img src="Ico/Bandoleiro.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-bandoleiro">Bandoleiro</span>
        </label>
        <label>
          <input type="checkbox" id="prof-cacador" checked> 
          <img src="Ico/Cacador.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-cacador">Caçador</span>
        </label>
        <label>
          <input type="checkbox" id="prof-cruzado" checked> 
          <img src="Ico/Cruzado.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-cruzado">Cruzado</span>
        </label>
        <label>
          <input type="checkbox" id="prof-druida" checked> 
          <img src="Ico/Druida.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-druida">Druida</span>
        </label>
        <label>
          <input type="checkbox" id="prof-encantador" checked> 
          <img src="Ico/Encantador.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-encantador">Encantador</span>
        </label>
        <label>
          <input type="checkbox" id="prof-ferreiro" checked> 
          <img src="Ico/Ferreiro.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-ferreiro">Ferreiro</span>
        </label>
        <label>
          <input type="checkbox" id="prof-inquisidor" checked> 
          <img src="Ico/Inquisidor.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-inquisidor">Inquisidor</span>
        </label>
        <label>
          <input type="checkbox" id="prof-ladrao" checked> 
          <img src="Ico/Ladrao.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-ladrao">Ladrão</span>
        </label>
        <label>
          <input type="checkbox" id="prof-mestredoaco" checked> 
          <img src="Ico/MestreDoAco.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-mestredoaco">Mestre do Aço</span>
        </label>
        <label>
          <input type="checkbox" id="prof-necromante" checked> 
          <img src="Ico/Necromante.png" style="width:16px;height:16px;margin-right:5px;">
          <span id="label-prof-necromante">Necromante</span>
        </label>
      </div>
    </div>
    
    <!-- Dropdown Comerciantes -->
    <div class="dropdown">
      <div class="dropdown-header">
        <label>
          <input type="checkbox" id="toggle-comerciantes" checked> 
          <img src="Ico/Comerciante.png" style="width:20px;height:20px;margin-right:5px;">
          <span id="label-comerciantes">Comerciantes</span>
        </label>
        <button id="dropdown-comerciantes">&#9662;</button>
      </div>
      <div class="dropdown-content" id="dropdown-content-comerciantes">
        <!-- Sub-dropdown para Armas -->
        <div class="dropdown">
          <button id="dropdown-armas">Armas &#9662;</button>
          <div class="dropdown-content" id="dropdown-content-armas">
            <label><input type="checkbox" id="comerciante-armas-IaV" checked> I a V</label>
            <label><input type="checkbox" id="comerciante-armas-VIaIX" checked> VI a IX</label>
            <label><input type="checkbox" id="comerciante-armas-XaXII" checked> X a XII</label>
          </div>
        </div>
        <!-- Sub-dropdown para Armaduras -->
        <div class="dropdown">
          <button id="dropdown-armaduras">Armaduras &#9662;</button>
          <div class="dropdown-content" id="dropdown-content-armaduras">
            <label><input type="checkbox" id="comerciante-armaduras-IaV" checked> I a V</label>
            <label><input type="checkbox" id="comerciante-armaduras-VIaIX" checked> VI a IX</label>
            <label><input type="checkbox" id="comerciante-armaduras-XaXII" checked> X a XII</label>
          </div>
        </div>
        <!-- Sub-dropdown para Anéis -->
        <div class="dropdown">
          <button id="dropdown-aneis">Anéis &#9662;</button>
          <div class="dropdown-content" id="dropdown-content-aneis">
            <label><input type="checkbox" id="comerciante-aneis-31_44" checked> 31 ~ 44</label>
            <label><input type="checkbox" id="comerciante-aneis-41_52" checked> 41 - 52</label>
            <label><input type="checkbox" id="comerciante-aneis-31_43" checked> 31 ~ 43</label>
          </div>
        </div>
        <!-- Sub-dropdown para Pós -->
        <div class="dropdown">
          <button id="dropdown-pos">Pós &#9662;</button>
          <div class="dropdown-content" id="dropdown-content-pos">
            <label><input type="checkbox" id="comerciante-pos-IaV" checked> I a V</label>
            <label><input type="checkbox" id="comerciante-pos-VIaIX" checked> VII a IX</label>
            <label><input type="checkbox" id="comerciante-pos-IXaXI" checked> IX a XI</label>
            <label><input type="checkbox" id="comerciante-pos-XIaXII" checked> XI a XII</label>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Crateras -->
    <div style="margin-bottom:10px;">
      <label>
        <input type="checkbox" id="craterasToggle" checked> 
        <img src="Ico/Cratera.png" style="width:20px;height:20px;margin-right:5px;">
        <span id="label-crateras">Crateras</span>
      </label>
    </div>
  </div>
  
  <!-- Container do mapa -->
  <div id="map"></div>
  
  <!-- Importa o Leaflet -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Variável para o idioma atual (padrão: pt)
      var currentLang = "pt";

      // Objeto com traduções para pt e en (interface e profissões)
      var translations = {
        pt: {
          title: "Mapa Sphere",
          showAll: "Mostrar tudo",
          hideAll: "Esconder tudo",
          searchPlaceholder: "Pesquisar...",
          coords: "Clique no mapa para ver as coordenadas",
          castelos: "Castelos",
          castelos15: "Castelos 15",
          castelos30: "Castelos 30",
          castelos45: "Castelos 45",
          teleporte: "Teleporte de Runas",
          profissoes: "Profissões",
          comerciantes: "Comerciantes",
          crateras: "Crateras",
          comerciante_armas: "Armas",
          comerciante_armaduras: "Armaduras",
          comerciante_aneis: "Anéis",
          comerciante_pos: "Pós",
          arquimago: "Arquimago",
          armeiro: "Armeiro",
          assassino: "Assassino",
          barbaro: "Bárbaro",
          bandoleiro: "Bandoleiro",
          cacador: "Caçador",
          cruzado: "Cruzado",
          druida: "Druida",
          encantador: "Encantador",
          ferreiro: "Ferreiro",
          inquisidor: "Inquisidor",
          ladrão: "Ladrão",
          mestredoaco: "Mestre do Aço",
          necromante: "Necromante",
          noMarkerFound: "Nenhum marcador encontrado para: "
        },
        en: {
          title: "Sphere Map",
          showAll: "Show All",
          hideAll: "Hide All",
          searchPlaceholder: "Search...",
          coords: "Click on the map to view coordinates",
          castelos: "Castles",
          castelos15: "Castles 15",
          castelos30: "Castles 30",
          castelos45: "Castles 45",
          teleporte: "Runes Teleport",
          profissoes: "Professions",
          comerciantes: "Merchants",
          crateras: "Craters",
          comerciante_armas: "Weapons",
          comerciante_armaduras: "Armors",
          comerciante_aneis: "Rings",
          comerciante_pos: "Posts",
          arquimago: "Archmage",
          armeiro: "Armorer",
          assassino: "Assassin",
          barbaro: "Barbarian",
          bandoleiro: "Bandit",
          cacador: "Hunter",
          cruzado: "Crusader",
          druida: "Druid",
          encantador: "Enchanter",
          ferreiro: "Blacksmith",
          inquisidor: "Inquisitor",
          ladrão: "Thief",
          mestredoaco: "Master of Steel",
          necromante: "Necromancer",
          noMarkerFound: "No marker found for: "
        }
      };

      // Objeto com traduções para as marcações de alguns marcadores (ex.: teleportes)
      var markerTranslations = {
        "Northern Road of Hyperion": { en: "Northern Road of Hyperion", pt: "Estrada Norte de Hyperion" },
        "North-western end of Hyperion": { en: "North-western end of Hyperion", pt: "Extremo Noroeste de Hyperion" },
        "Sheepston-Sunpool Road": { en: "Sheepston-Sunpool Road", pt: "Estrada Sheepston-Sunpool" },
        "Field by the Sheepstone-Sunpool Road": { en: "Field by the Sheepstone-Sunpool Road", pt: "Campo próximo à Estrada Sheepstone-Sunpool" },
        "North-east of Hyperion": { en: "North-east of Hyperion", pt: "Nordeste de Hyperion" },
        "Umrad Forest": { en: "Umrad Forest", pt: "Floresta Umrad" },
        "Silver Forest": { en: "Silver Forest", pt: "Floresta de Prata" },
        "Sheepston-Torweal Road": { en: "Sheepston-Torweal Road", pt: "Estrada Sheepston-Torweal" },
        "Mountains between Sheepstone and Bangville": { en: "Mountains between Sheepstone and Bangville", pt: "Montanhas entre Sheepstone e Bangville" },
        "Lake Temer": { en: "Lake Temer", pt: "Lago Temer" },
        "Sheepston-Sunpool Road near Lake Vortex": { en: "Sheepston-Sunpool Road near Lake Vortex", pt: "Estrada Sheepston-Sunpool perto do Lago Vortex" },
        "Sunpool-Bangville Road near Lake Vortex": { en: "Sunpool-Bangville Road near Lake Vortex", pt: "Estrada Sunpool-Bangville perto do Lago Vortex" },
        "Heber Island (Lake Temer)": { en: "Heber Island (Lake Temer)", pt: "Ilha Heber (Lago Temer)" },
        "Foros Island (Lake Vortex)": { en: "Foros Island (Lake Vortex)", pt: "Ilha Foros (Lago Vortex)" },
        "Mounth of the Nerey": { en: "Mounth of the Nerey", pt: "Monte do Nerey" },
        "Deyros Island (Lake Vortex)": { en: "Deyros Island (Lake Vortex)", pt: "Ilha Deyros (Lago Vortex)" },
        "Eastern Forest": { en: "Eastern Forest", pt: "Floresta Leste" },
        "Mounth of Dioma": { en: "Mounth of Dioma", pt: "Monte de Dioma" },
        "Horton Forest": { en: "Horton Forest", pt: "Floresta Horton" },
        "Island Patros (Lake Satin)": { en: "Island Patros (Lake Satin)", pt: "Ilha Patros (Lago Satin)" },
        "South-Eastern mountains pocket": { en: "South-Eastern mountains pocket", pt: "Cova das Montanhas do Sudeste" },
        "North of Coyton Forest": { en: "North of Coyton Forest", pt: "Norte da Floresta de Coyton" },
        "South-western end of Hyperion": { en: "South-western end of Hyperion", pt: "Extremo Sudoeste de Hyperion" },
        "Tantal Bridge": { en: "Tantal Bridge", pt: "Ponte Tantal" },
        "Obol": { en: "Obol", pt: "Obol" }
      };

      // Função para aplicar a tradução na interface e atualizar as marcações do mapa
      function setLanguage(lang) {
        currentLang = lang;
        document.getElementById("title").innerText = translations[lang].title;
        document.getElementById("btn-showAll").innerText = translations[lang].showAll;
        document.getElementById("btn-hideAll").innerText = translations[lang].hideAll;
        document.getElementById("searchInput").placeholder = translations[lang].searchPlaceholder;
        document.getElementById("coords").innerText = translations[lang].coords;
        document.getElementById("label-castelos").innerText = translations[lang].castelos;
        document.getElementById("label-castelos15").innerText = translations[lang].castelos15;
        document.getElementById("label-castelos30").innerText = translations[lang].castelos30;
        document.getElementById("label-castelos45").innerText = translations[lang].castelos45;
        document.getElementById("label-teleporte").innerText = translations[lang].teleporte;
        document.getElementById("label-profissoes").innerText = translations[lang].profissoes;
        document.getElementById("label-comerciantes").innerText = translations[lang].comerciantes;
        document.getElementById("label-crateras").innerText = translations[lang].crateras;
        // Comerciante sub-dropdowns – se houver elementos com estes ids, atualize-os
        // (Exemplo: "label-comerciante-armas", etc. Se não estiverem no HTML, podem ser ignorados)
        // Profissões:
        document.getElementById("label-prof-arquimago").innerText = translations[lang].arquimago;
        document.getElementById("label-prof-armeiro").innerText = translations[lang].armeiro;
        document.getElementById("label-prof-assassino").innerText = translations[lang].assassino;
        document.getElementById("label-prof-barbaro").innerText = translations[lang].barbaro;
        document.getElementById("label-prof-bandoleiro").innerText = translations[lang].bandoleiro;
        document.getElementById("label-prof-cacador").innerText = translations[lang].cacador;
        document.getElementById("label-prof-cruzado").innerText = translations[lang].cruzado;
        document.getElementById("label-prof-druida").innerText = translations[lang].druida;
        document.getElementById("label-prof-encantador").innerText = translations[lang].encantador;
        document.getElementById("label-prof-ferreiro").innerText = translations[lang].ferreiro;
        document.getElementById("label-prof-inquisidor").innerText = translations[lang].inquisidor;
        document.getElementById("label-prof-ladrao").innerText = translations[lang].ladrão;
        document.getElementById("label-prof-mestredoaco").innerText = translations[lang].mestredoaco;
        document.getElementById("label-prof-necromante").innerText = translations[lang].necromante;
        // Atualiza os textos dos tooltips dos marcadores
        updateMarkersText();
      }

      // Atualiza os tooltips dos marcadores conforme o idioma
      function updateMarkersText() {
        var layers = [];
        layers.push(castleLayer15, castleLayer30, castleLayer45, teleporteLayer, crateraLayer);
        Object.values(comercianteLayersArmas).forEach(function(l) { layers.push(l); });
        Object.values(comercianteLayersArmaduras).forEach(function(l) { layers.push(l); });
        Object.values(comercianteLayersAneis).forEach(function(l) { layers.push(l); });
        Object.values(comercianteLayersPos).forEach(function(l) { layers.push(l); });
        Object.values(profissaoLayers).forEach(function(l) { layers.push(l); });
        layers.forEach(function(layer) {
          layer.eachLayer(function(marker) {
            if(marker.originalName) {
              // Para profissões, verifique se há tradução no objeto translations (usando a chave normalizada)
              var normalizedKey = marker.originalName.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().replace(/\s/g, "");
              if(translations[currentLang][normalizedKey] !== undefined) {
                marker.setTooltipContent("<span class='castle-label'>" + translations[currentLang][normalizedKey] + "</span>");
              }
              // Caso exista tradução específica para o marcador (por exemplo, teleportes)
              else if(markerTranslations[marker.originalName]) {
                marker.setTooltipContent("<span class='castle-label'>" + markerTranslations[marker.originalName][currentLang] + "</span>");
              } else {
                marker.setTooltipContent("<span class='castle-label'>" + marker.originalName + "</span>");
              }
            }
          });
        });
      }

      // Eventos das bandeiras para troca de idioma
      document.getElementById("lang-pt").addEventListener("click", function() { setLanguage("pt"); });
      document.getElementById("lang-en").addEventListener("click", function() { setLanguage("en"); });

      // Função para alternar exibição dos dropdowns
      function toggleDropdown(id) {
        var content = document.getElementById(id);
        content.style.display = (content.style.display === "block") ? "none" : "block";
      }
      
      // Eventos para os botões dos dropdowns
      document.getElementById("dropdown-castelos").addEventListener("click", function() { toggleDropdown("dropdown-content-castelos"); });
      document.getElementById("dropdown-teleporte").addEventListener("click", function() { toggleDropdown("dropdown-content-teleporte"); });
      document.getElementById("dropdown-profissoes").addEventListener("click", function() { toggleDropdown("dropdown-content-profissoes"); });
      document.getElementById("dropdown-comerciantes").addEventListener("click", function() { toggleDropdown("dropdown-content-comerciantes"); });
      document.getElementById("dropdown-armas").addEventListener("click", function() { toggleDropdown("dropdown-content-armas"); });
      document.getElementById("dropdown-armaduras").addEventListener("click", function() { toggleDropdown("dropdown-content-armaduras"); });
      document.getElementById("dropdown-aneis").addEventListener("click", function() { toggleDropdown("dropdown-content-aneis"); });
      document.getElementById("dropdown-pos").addEventListener("click", function() { toggleDropdown("dropdown-content-pos"); });
      
      // Inicializa o mapa
      var map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: -2,
        maxZoom: 2,
        zoomControl: false
      });
      L.control.zoom({ position: 'topright' }).addTo(map);
      var imageUrl = 'Hyperion-BR.png';
      var imageBounds = [[0, 0], [1536, 888]];
      L.imageOverlay(imageUrl, imageBounds).addTo(map);
      map.setView([768, 444], 0);
      
      // Função para criar ícones
      function createIcon(iconUrl) {
        return L.icon({
          iconUrl: iconUrl,
          iconSize: [30, 30],
          iconAnchor: [15, 30]
        });
      }
      
      // Ícones padrão e dos subitens
      var casteloIcon = createIcon('Ico/Castelo.png');
      var teleporteIcon = createIcon('Ico/Teleporte.png');
      var crateraIcon = createIcon('Ico/Cratera.png');
      var profIcons = {
        "Arquimago": createIcon("Ico/Arquimago.png"),
        "Armeiro": createIcon("Ico/Armeiro.png"),
        "Assassino": createIcon("Ico/Assassino.png"),
        "Bárbaro": createIcon("Ico/Barbaro.png"),
        "Bandoleiro": createIcon("Ico/Bandoleiro.png"),
        "Caçador": createIcon("Ico/Cacador.png"),
        "Cruzado": createIcon("Ico/Cruzado.png"),
        "Druida": createIcon("Ico/Druida.png"),
        "Encantador": createIcon("Ico/Encantador.png"),
        "Ferreiro": createIcon("Ico/Ferreiro.png"),
        "Inquisidor": createIcon("Ico/Inquisidor.png"),
        "Ladrão": createIcon("Ico/Ladrao.png"),
        "Mestre do Aço": createIcon("Ico/MestreDoAco.png"),
        "Necromante": createIcon("Ico/Necromante.png")
      };
      var comercianteArmasIcon = createIcon('Ico/ComercianteArmas.png');
      var comercianteArmadurasIcon = createIcon('Ico/ComercianteArmaduras.png');
      var comercianteAneisIcon = createIcon('Ico/ComercianteAneis.png');
      var comerciantePosIcon = createIcon('Ico/ComerciantePos.png');
      
      // Dados de marcadores
      var castelos15 = [
        { nome: 'Liege', pos: [852, 462] },
        { nome: 'Peltier', pos: [671.5, 513.5] },
        { nome: 'Aris', pos: [1054, 694] },
        { nome: 'Chatelie', pos: [604, 263] }
      ];
      var castelos30 = [
        { nome: 'Gideon', pos: [394, 151] },
        { nome: 'Feoff', pos: [791, 594] },
        { nome: 'Latour', pos: [1156, 456] },
        { nome: 'Cablac', pos: [1039, 384] },
        { nome: 'Eikum Kas', pos: [928, 343] },
        { nome: 'Sabulat', pos: [468, 301] },
        { nome: 'Triumphaler', pos: [333, 364] },
        { nome: 'Ionat', pos: [368, 747] },
        { nome: 'Blessendour', pos: [132, 484] },
        { nome: 'Devanagary', pos: [505, 561] }
      ];
      var castelos45 = [
        { nome: 'Ammalaelle', pos: [913, 151] },
        { nome: 'Tyanod', pos: [1343, 762] },
        { nome: 'Temoval', pos: [997, 840] },
        { nome: 'Kare Royal', pos: [552, 786] },
        { nome: 'Diffensat', pos: [77, 103] }
      ];
      var teleportes = [
        { nome: 'Northern Road of Hyperion', pos: [1278, 682] },
        { nome: 'North-western end of Hyperion', pos: [1096, 149] },
        { nome: 'Sheepston-Sunpool Road', pos: [1069.5, 459] },
        { nome: 'Field by the Sheepstone-Sunpool Road', pos: [1026.5, 511] },
        { nome: 'North-east of Hyperion', pos: [1034, 834] },
        { nome: 'Umrad Forest', pos: [980, 514] },
        { nome: 'Silver Forest', pos: [974, 258] },
        { nome: 'Sheepston-Torweal Road', pos: [945, 658.5] },
        { nome: 'Mountains between Sheepstone and Bangville', pos: [898, 587.5] },
        { nome: 'Lake Temer', pos: [857, 814.5] },
        { nome: 'Sheepston-Sunpool Road near Lake Vortex', pos: [783, 114] },
        { nome: 'Sunpool-Bangville Road near Lake Vortex', pos: [782, 318] },
        { nome: 'Heber Island (Lake Temer)', pos: [777, 755.5] },
        { nome: 'Foros Island (Lake Vortex)', pos: [712.103608, 208.018284] },
        { nome: 'Mounth of the Nerey', pos: [715, 388] },
        { nome: 'Deyros Island (Lake Vortex)', pos: [541, 351] },
        { nome: 'Eastern Forest', pos: [542, 819.5] },
        { nome: 'Mounth of Dioma', pos: [502.5, 514.5] },
        { nome: 'Horton Forest', pos: [440.103608, 100.018284] },
        { nome: 'Mountains near the Sunpool-Torweal Road', pos: [] },
        { nome: 'Island Patros (Lake Satin)', pos: [237.5, 369] },
        { nome: 'South-Eastern mountains pocket', pos: [262.5, 611] },
        { nome: 'North of Coyton Forest', pos: [139, 154] },
        { nome: 'South-western end of Hyperion', pos: [54, 76] },
        { nome: 'Tantal Bridge', pos: [1144.998227, 317.000074] },
        { nome: 'Obol', pos: [1199, 285] }
      ];
      // Dados de profissões
      var profissoes = [
        { nome: 'Arquimago', pos: [304, 410] },
        { nome: 'Armeiro', pos: [98, 526] },
        { nome: 'Assassino', pos: [508.5, 761.5] },
        { nome: 'Bárbaro', pos: [740, 805] },
        { nome: 'Bandoleiro', pos: [290.5, 703] },
        { nome: 'Caçador', pos: [644.25, 545.25] },
        { nome: 'Cruzado', pos: [871, 72] },
        { nome: 'Druida', pos: [928, 417] },
        { nome: 'Encantador', pos: [1062, 238] },
        { nome: 'Ferreiro', pos: [1050.5, 583.5] },
        { nome: 'Inquisidor', pos: [322, 89] },
        { nome: 'Ladrão', pos: [1198, 323.5] },
        { nome: 'Mestre do Aço', pos: [1395.5, 767] },
        { nome: 'Necromante', pos: [502.5, 418] }
      ];
      // Dados de crateras
      var crateras = [
        { nome: 'Cratera', pos: [782, 318] },
        { nome: 'Cratera', pos: [139, 154] },
        { nome: 'Cratera', pos: [865, 364] },
        { nome: 'Cratera', pos: [1182, 364] },
        { nome: 'Cratera', pos: [1278, 682] },
        { nome: 'Cratera', pos: [945, 658.5] },
        { nome: 'Cratera', pos: [898, 587.5] },
        { nome: 'Cratera', pos: [1026.5, 511] },
        { nome: 'Cratera', pos: [542, 819.5] },
        { nome: 'Cratera', pos: [262.5, 611] },
        { nome: 'Cratera', pos: [440.103608, 100.018284] },
        { nome: 'Cratera', pos: [237.5, 369] },
        { nome: 'Cratera', pos: [444, 361] },
        { nome: 'Cratera', pos: [974, 258] }
      ];
      
      // Dados dos comerciantes
      var comerciantesArmas = {
        "I a V": [
          { nome: 'Kevin Doltere', pos: [389.5, 551] }
        ],
        "VI a IX": [],
        "X a XII": []
      };
      var comerciantesArmaduras = {
        "I a V": [
          { nome: 'James Cudd', pos: [389.5, 551] }
        ],
        "VI a IX": [],
        "X a XII": []
      };
      var comerciantesAneis = {
        "31 ~ 44": [
          { nome: 'Wanda Ramonse', pos: [438, 652.5] }
        ],
        "41 - 52": [
          { nome: 'Fabia Nandor', pos: [1226, 804] }
        ],
        "31 ~ 43": [
          { nome: 'Eclera Taranton', pos: [335, 241] }
        ]
      };
      var comerciantesPos = {
        "I a V": [],
        "VII a IX": [
          { nome: 'Clara Rosens', pos: [438, 652.5] },
          { nome: 'Rose Clarense', pos: [335, 241] }
        ],
        "IX a XI": [
          { nome: 'Lina Parker', pos: [1226, 804] }
        ],
        "XI a XII": []
      };
      
      // Cria layer groups para comerciantes
      var comercianteLayersArmas = {}, comercianteLayersArmaduras = {}, comercianteLayersAneis = {}, comercianteLayersPos = {};
      
      function addComercianteMarkersForGroup(layer, items, icon) {
        layer.clearLayers();
        items.forEach(function(item) {
          if(item.pos && item.pos.length > 0) {
            var marker = L.marker(item.pos, { icon: icon });
            marker.originalName = item.nome;
            marker.bindPopup("<strong>" + item.nome + "</strong>");
            layer.addLayer(marker);
          }
        });
      }
      
      Object.keys(comerciantesArmas).forEach(function(chave) {
        var lyr = L.layerGroup();
        addComercianteMarkersForGroup(lyr, comerciantesArmas[chave], comercianteArmasIcon);
        comercianteLayersArmas[chave] = lyr;
        map.addLayer(lyr);
      });
      Object.keys(comerciantesArmaduras).forEach(function(chave) {
        var lyr = L.layerGroup();
        addComercianteMarkersForGroup(lyr, comerciantesArmaduras[chave], comercianteArmadurasIcon);
        comercianteLayersArmaduras[chave] = lyr;
        map.addLayer(lyr);
      });
      Object.keys(comerciantesAneis).forEach(function(chave) {
        var lyr = L.layerGroup();
        addComercianteMarkersForGroup(lyr, comerciantesAneis[chave], comercianteAneisIcon);
        comercianteLayersAneis[chave] = lyr;
        map.addLayer(lyr);
      });
      Object.keys(comerciantesPos).forEach(function(chave) {
        var lyr = L.layerGroup();
        addComercianteMarkersForGroup(lyr, comerciantesPos[chave], comerciantePosIcon);
        comercianteLayersPos[chave] = lyr;
        map.addLayer(lyr);
      });
      
      // Cria layer groups para castelos, teleportes e crateras
      var castleLayer15 = L.layerGroup(), castleLayer30 = L.layerGroup(), castleLayer45 = L.layerGroup();
      var teleporteLayer = L.layerGroup(), crateraLayer = L.layerGroup();
      
      function addMarkers(layer, items, iconFunc) {
        layer.clearLayers();
        items.forEach(function(item) {
          if(item.pos && item.pos.length > 0) {
            var marker = L.marker(item.pos, { icon: iconFunc(item) });
            marker.originalName = item.nome;
            marker.bindTooltip("<span class='castle-label'>" + item.nome + "</span>", {
              permanent: true,
              direction: 'bottom',
              offset: [0, 10],
              className: 'castle-label'
            });
            layer.addLayer(marker);
          }
        });
      }
      
      function castleIconFunc(item) { return casteloIcon; }
      addMarkers(castleLayer15, castelos15, castleIconFunc);
      addMarkers(castleLayer30, castelos30, castleIconFunc);
      addMarkers(castleLayer45, castelos45, castleIconFunc);
      
      function teleporteIconFunc(item) { return teleporteIcon; }
      addMarkers(teleporteLayer, teleportes, teleporteIconFunc);
      
      function crateraIconFunc(item) { return crateraIcon; }
      addMarkers(crateraLayer, crateras, crateraIconFunc);
      
      // Cria layers individuais para cada profissão
      var profissaoLayers = {};
      profissoes.forEach(function(item) {
        var layer = L.layerGroup();
        var marker = L.marker(item.pos, { icon: profIcons[item.nome] || createIcon("Ico/Profissao.png") });
        marker.originalName = item.nome;
        marker.bindTooltip("<span class='castle-label'>" + item.nome + "</span>", {
          permanent: true,
          direction: 'bottom',
          offset: [0, 10],
          className: 'castle-label'
        });
        marker.bindPopup("<strong>" + item.nome + "</strong>");
        layer.addLayer(marker);
        profissaoLayers[item.nome] = layer;
        map.addLayer(layer);
      });
      
      // Adiciona inicialmente as layers (exceto as de profissões, que já foram adicionadas individualmente)
      castleLayer15.addTo(map);
      castleLayer30.addTo(map);
      castleLayer45.addTo(map);
      teleporteLayer.addTo(map);
      crateraLayer.addTo(map);
      
      // Evento para o checkbox de Crateras
      document.getElementById("craterasToggle").addEventListener("change", function() {
        this.checked ? map.addLayer(crateraLayer) : map.removeLayer(crateraLayer);
      });
      
      // Função para atualizar todas as layers
      function updateAllLayers(visible) {
        [castleLayer15, castleLayer30, castleLayer45, teleporteLayer, crateraLayer].forEach(function(layer) {
          visible ? (map.hasLayer(layer) || map.addLayer(layer)) : (map.hasLayer(layer) && map.removeLayer(layer));
        });
        for(var key in profissaoLayers) {
          visible ? (map.hasLayer(profissaoLayers[key]) || map.addLayer(profissaoLayers[key])) : (map.hasLayer(profissaoLayers[key]) && map.removeLayer(profissaoLayers[key]));
        }
        Object.keys(comercianteLayersArmas).forEach(function(chave) {
          visible ? (map.hasLayer(comercianteLayersArmas[chave]) || map.addLayer(comercianteLayersArmas[chave])) : (map.hasLayer(comercianteLayersArmas[chave]) && map.removeLayer(comercianteLayersArmas[chave]));
        });
        Object.keys(comercianteLayersArmaduras).forEach(function(chave) {
          visible ? (map.hasLayer(comercianteLayersArmaduras[chave]) || map.addLayer(comercianteLayersArmaduras[chave])) : (map.hasLayer(comercianteLayersArmaduras[chave]) && map.removeLayer(comercianteLayersArmaduras[chave]));
        });
        Object.keys(comercianteLayersAneis).forEach(function(chave) {
          visible ? (map.hasLayer(comercianteLayersAneis[chave]) || map.addLayer(comercianteLayersAneis[chave])) : (map.hasLayer(comercianteLayersAneis[chave]) && map.removeLayer(comercianteLayersAneis[chave]));
        });
        Object.keys(comercianteLayersPos).forEach(function(chave) {
          visible ? (map.hasLayer(comercianteLayersPos[chave]) || map.addLayer(comercianteLayersPos[chave])) : (map.hasLayer(comercianteLayersPos[chave]) && map.removeLayer(comercianteLayersPos[chave]));
        });
      }
      
      // Botões "Mostrar tudo" e "Esconder tudo"
      function showAll() {
        updateAllLayers(true);
        document.querySelectorAll("#control-panel input[type='checkbox']").forEach(function(chk) { chk.checked = true; });
      }
      function hideAll() {
        updateAllLayers(false);
        document.querySelectorAll("#control-panel input[type='checkbox']").forEach(function(chk) { chk.checked = false; });
      }
      document.getElementById("btn-showAll").addEventListener("click", showAll);
      document.getElementById("btn-hideAll").addEventListener("click", hideAll);
      
      // Eventos dos checkboxes dos sub-dropdowns de Castelos
      document.getElementById("castle15").addEventListener("change", function() {
        this.checked ? map.addLayer(castleLayer15) : map.removeLayer(castleLayer15);
      });
      document.getElementById("castle30").addEventListener("change", function() {
        this.checked ? map.addLayer(castleLayer30) : map.removeLayer(castleLayer30);
      });
      document.getElementById("castle45").addEventListener("change", function() {
        this.checked ? map.addLayer(castleLayer45) : map.removeLayer(castleLayer45);
      });
      
      // Eventos para os checkboxes das categorias principais
      document.getElementById("toggle-castelos").addEventListener("change", function() {
        if(this.checked) {
          map.addLayer(castleLayer15); map.addLayer(castleLayer30); map.addLayer(castleLayer45);
        } else {
          map.removeLayer(castleLayer15); map.removeLayer(castleLayer30); map.removeLayer(castleLayer45);
        }
      });
      document.getElementById("toggle-teleporte").addEventListener("change", function() {
        this.checked ? map.addLayer(teleporteLayer) : map.removeLayer(teleporteLayer);
      });
      document.getElementById("toggle-profissoes").addEventListener("change", function() {
        for(var key in profissaoLayers) {
          var normalizedKey = key.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().replace(/\s/g, "");
          var checkbox = document.getElementById("prof-" + normalizedKey);
          if(this.checked) {
            !map.hasLayer(profissaoLayers[key]) && map.addLayer(profissaoLayers[key]);
            if(checkbox) checkbox.checked = true;
          } else {
            map.hasLayer(profissaoLayers[key]) && map.removeLayer(profissaoLayers[key]);
            if(checkbox) checkbox.checked = false;
          }
        }
      });
      document.getElementById("toggle-comerciantes").addEventListener("change", function() {
        var state = this.checked;
        Object.keys(comercianteLayersArmas).forEach(function(chave) {
          var checkbox = document.getElementById("comerciante-armas-" + chave.replace(/\s|~/g, ""));
          if(checkbox) { checkbox.checked = state; state ? map.addLayer(comercianteLayersArmas[chave]) : map.removeLayer(comercianteLayersArmas[chave]); }
        });
        Object.keys(comercianteLayersArmaduras).forEach(function(chave) {
          var checkbox = document.getElementById("comerciante-armaduras-" + chave.replace(/\s|~/g, ""));
          if(checkbox) { checkbox.checked = state; state ? map.addLayer(comercianteLayersArmaduras[chave]) : map.removeLayer(comercianteLayersArmaduras[chave]); }
        });
        Object.keys(comercianteLayersAneis).forEach(function(chave) {
          var checkbox = document.getElementById("comerciante-aneis-" + chave.replace(/\s|[-~]/g, function(match){ return match===' ' ? "" : "_" }));
          if(checkbox) { checkbox.checked = state; state ? map.addLayer(comercianteLayersAneis[chave]) : map.removeLayer(comercianteLayersAneis[chave]); }
        });
        Object.keys(comercianteLayersPos).forEach(function(chave) {
          var checkbox = document.getElementById("comerciante-pos-" + chave.replace(/\s|[-]/g, function(match){ return match===' ' ? "" : "_" }));
          if(checkbox) { checkbox.checked = state; state ? map.addLayer(comercianteLayersPos[chave]) : map.removeLayer(comercianteLayersPos[chave]); }
        });
      });
      
      // Eventos dos sub-dropdowns de Comerciantes
      document.getElementById("comerciante-armas-IaV").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersArmas["I a V"]) : map.removeLayer(comercianteLayersArmas["I a V"]);
      });
      document.getElementById("comerciante-armas-VIaIX").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersArmas["VI a IX"]) : map.removeLayer(comercianteLayersArmas["VI a IX"]);
      });
      document.getElementById("comerciante-armas-XaXII").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersArmas["X a XII"]) : map.removeLayer(comercianteLayersArmas["X a XII"]);
      });
      document.getElementById("comerciante-armaduras-IaV").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersArmaduras["I a V"]) : map.removeLayer(comercianteLayersArmaduras["I a V"]);
      });
      document.getElementById("comerciante-armaduras-VIaIX").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersArmaduras["VI a IX"]) : map.removeLayer(comercianteLayersArmaduras["VI a IX"]);
      });
      document.getElementById("comerciante-armaduras-XaXII").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersArmaduras["X a XII"]) : map.removeLayer(comercianteLayersArmaduras["X a XII"]);
      });
      document.getElementById("comerciante-aneis-31_44").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersAneis["31 ~ 44"]) : map.removeLayer(comercianteLayersAneis["31 ~ 44"]);
      });
      document.getElementById("comerciante-aneis-41_52").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersAneis["41 - 52"]) : map.removeLayer(comercianteLayersAneis["41 - 52"]);
      });
      document.getElementById("comerciante-aneis-31_43").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersAneis["31 ~ 43"]) : map.removeLayer(comercianteLayersAneis["31 ~ 43"]);
      });
      document.getElementById("comerciante-pos-IaV").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersPos["I a V"]) : map.removeLayer(comercianteLayersPos["I a V"]);
      });
      document.getElementById("comerciante-pos-VIaIX").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersPos["VII a IX"]) : map.removeLayer(comercianteLayersPos["VII a IX"]);
      });
      document.getElementById("comerciante-pos-IXaXI").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersPos["IX a XI"]) : map.removeLayer(comercianteLayersPos["IX a XI"]);
      });
      document.getElementById("comerciante-pos-XIaXII").addEventListener("change", function() {
        this.checked ? map.addLayer(comercianteLayersPos["XI a XII"]) : map.removeLayer(comercianteLayersPos["XI a XII"]);
      });
      
      // Vincula os checkboxes individuais das Profissões (usando normalização para o id)
      Object.keys(profissaoLayers).forEach(function(key) {
         var normalizedKey = key.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().replace(/\s/g, "");
         var checkbox = document.getElementById("prof-" + normalizedKey);
         if(checkbox) {
           checkbox.addEventListener("change", function(e) {
             this.checked ? map.addLayer(profissaoLayers[key]) : map.removeLayer(profissaoLayers[key]);
           });
         }
      });
      
      // Pesquisa com auto-complete (para castelos, teleportes, comerciantes e profissões)
      var suggestions = [];
      function updateSuggestions() {
        suggestions = [];
        [castelos15, castelos30, castelos45].forEach(function(arr) { arr.forEach(function(item) { suggestions.push(item.nome); }); });
        teleportes.forEach(function(item) { suggestions.push(item.nome); });
        [comerciantesArmas, comerciantesArmaduras, comerciantesAneis, comerciantesPos].forEach(function(cat) {
          for(var key in cat) { cat[key].forEach(function(item) { suggestions.push(item.nome); }); }
        });
        profissoes.forEach(function(item) { suggestions.push(item.nome); });
      }
      updateSuggestions();
      var searchInput = document.getElementById("searchInput");
      var searchSuggestions = document.getElementById("searchSuggestions");
      searchInput.addEventListener("input", function() {
        var query = this.value.toLowerCase();
        searchSuggestions.innerHTML = "";
        if(query === "") { searchSuggestions.style.display = "none"; return; }
        var matches = suggestions.filter(function(item) { return item.toLowerCase().indexOf(query) !== -1; });
        if(matches.length > 0) {
          matches.forEach(function(match) {
            var div = document.createElement("div");
            div.textContent = match;
            div.addEventListener("click", function() {
              searchInput.value = match;
              searchSuggestions.innerHTML = "";
              searchSuggestions.style.display = "none";
              searchMarkers(match);
            });
            searchSuggestions.appendChild(div);
          });
          searchSuggestions.style.display = "block";
        } else { searchSuggestions.style.display = "none"; }
      });
      
      function searchMarkers(query) {
        query = query.toLowerCase();
        var found = false, markerFound;
        function searchLayerGroup(layerGroup) {
          layerGroup.eachLayer(function(marker) {
            var content = marker.getPopup() ? marker.getPopup().getContent() : marker.getTooltip().getContent();
            content = content.replace(/<[^>]+>/g, '').toLowerCase();
            if(content.indexOf(query) !== -1) { markerFound = marker; found = true; }
          });
        }
        searchLayerGroup(castleLayer15);
        searchLayerGroup(castleLayer30);
        searchLayerGroup(castleLayer45);
        searchLayerGroup(teleporteLayer);
        Object.keys(comercianteLayersArmas).forEach(function(key) { searchLayerGroup(comercianteLayersArmas[key]); });
        Object.keys(comercianteLayersArmaduras).forEach(function(key) { searchLayerGroup(comercianteLayersArmaduras[key]); });
        Object.keys(comercianteLayersAneis).forEach(function(key) { searchLayerGroup(comercianteLayersAneis[key]); });
        Object.keys(comercianteLayersPos).forEach(function(key) { searchLayerGroup(comercianteLayersPos[key]); });
        for(var key in profissaoLayers) { searchLayerGroup(profissaoLayers[key]); }
        if(found && markerFound) {
          map.setView(markerFound.getLatLng(), 1);
          markerFound.openPopup();
        } else { alert(translations[currentLang].noMarkerFound + query); }
      }
      
      document.getElementById("searchButton").addEventListener("click", function() {
        searchMarkers(searchInput.value);
      });
      
      // Exibe inicialmente todas as layers e marca todos os checkboxes
      showAll();
      // Aplica o idioma padrão
      setLanguage("pt");
    });
  </script>
</body>
</html>
